# SolarWinds Kubernetes Workload Type Processor

<!-- distribution links hack -->
[verified]: https://github.com/solarwinds/solarwinds-otel-collector-releases/tree/main/distributions/verified
[playground]: https://github.com/solarwinds/solarwinds-otel-collector-releases/tree/main/distributions/playground
[k8s]: https://github.com/solarwinds/solarwinds-otel-collector-releases/tree/main/distributions/k8s

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [development]: metrics   |
| Distributions | [k8s], [playground], [verified] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/solarwinds/solarwinds-otel-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Aprocessor%2Fswok8sworkloadtype%20&label=open&color=orange&logo=opentelemetry)](https://github.com/solarwinds/solarwinds-otel-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Aprocessor%2Fswok8sworkloadtype) [![Closed issues](https://img.shields.io/github/issues-search/solarwinds/solarwinds-otel-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Aprocessor%2Fswok8sworkloadtype%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/solarwinds/solarwinds-otel-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Aprocessor%2Fswok8sworkloadtype) |

[development]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#development
[k8s]: https://github.com/open-telemetry/opentelemetry-collector-releases/tree/main/distributions/otelcol-k8s
[playground]: 
[verified]: 
<!-- end autogenerated section -->

The SolarWinds Kubernetes Workload Type Processor collects objects from the Kubernetes API server and then annotates metric datapoints with a Kind of the workload they are related to.

## Configuration

### Example

The following is an example configuration:

```yaml
swok8sworkloadtype:
  workload_mappings:
    - name_attr: "dest_workload"
      namespace_attr: "dest_workload_namespace"
      workload_type_attr: "dest_workload_type"
      expected_types:
        - deployments
        - pods
    - address_attr: "dest_workload_address"
      workload_name_attr: "dest_workload_name"
      workload_namespace_attr: "dest_workload_namespace"
      workload_type_attr: "dest_workload_type"
      prefer_owner_for_pods: true
      expected_types:
        - deployments
        - pods
```

In the example, the processor is configured to look for datapoint attributes `dest_workload` and `dest_workload_namespace`. And if they exist, the processor looks for a k8s deployment or pod workload (in that order) matching the name and namespace. If such workload is found, its Kind (`Deployment` or `Pod`) is put into the attribute `dest_workload_type`.

Then the second mapping is executed. If the `dest_workload_type` attribute still doesn't have any value, the processor tries to map the URL in attribute `dest_workload_address` to a k8s workload. And if successful, it puts the workload's name, namespace and Kind into attributes `dest_workload_name`, `dest_workload_namespace` and `dest_workload_type`, respectively.

Since the second mapping has `prefer_owner_for_pods` set to `true`, if the found workload is a Pod, the processor looks for its owner instead. StatefulSets as owners are skipped if they have an owner of their own, e.g. a Deployment.

Please refer to [config.go](./config.go) for the config spec. Refer to [config.yaml](./testdata/config.yaml) for detailed examples on using the processor.
